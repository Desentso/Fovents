function searchFor(a){13==event.keyCode&&getEvents(a.value)}function getEvents(a){var b=$("#within").val(),c=$("#category").val(),d=$("#sdate").val(),e=$("#edate").val();$.ajax({url:"/getEvents?place="+a+"&within="+b+"&category="+c+"&startdate="+d+"&enddate="+e,method:"GET",success:function(a){a=JSON.parse(a),locateOnMap(a),$("#loading").hide()}})}function locateOnMap(a){eventsData=a,$("#eventsList").empty();var b=new google.maps.InfoWindow({content:""});if(markers=[],0!=a.events.length){var c={lat:parseFloat(a.events[0].lat),lng:parseFloat(a.events[0].long)};$("#eventsList").append("<div id='eventsTopBar'><p id='eventsFound'>"+a.events.length+" Events Found</p><p id='span'>Sort by</p><select id='sortBy'><option name='sort'>Size</option><option name='sort'>Date</option><option name='sort'>Category</option></select></div>"),zoom=11}else{var c={lat:39.127924,lng:-100.11821};zoom=5,$("#eventsList").append("<div id='eventsTopBar'><p id='eventsFound'>0 Events Found</p></div>")}map=new google.maps.Map(document.getElementById("map"),{zoom:zoom,center:c,mapTypeControlOptions:{mapTypeIds:["Apple","roadmap","Simple"]}}),$("#eventsList").append("<div id='events'></div>"),d=new google.maps.StyledMapType([{elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative",stylers:[{color:"#efebe2"},{visibility:"off"}]},{featureType:"administrative",elementType:"labels.text",stylers:[{color:"#5b5b5b"},{visibility:"on"}]},{featureType:"administrative",elementType:"labels.text.stroke",stylers:[{visibility:"off"}]},{featureType:"landscape",stylers:[{color:"#efebe2"}]},{featureType:"poi",stylers:[{color:"#efebe2"}]},{featureType:"poi.attraction",stylers:[{color:"#efebe2"}]},{featureType:"poi.business",stylers:[{color:"#efebe2"}]},{featureType:"poi.government",stylers:[{color:"#dfdcd5"}]},{featureType:"poi.medical",stylers:[{color:"#dfdcd5"}]},{featureType:"poi.park",stylers:[{color:"#bad294"}]},{featureType:"poi.place_of_worship",stylers:[{color:"#efebe2"}]},{featureType:"poi.school",stylers:[{color:"#efebe2"}]},{featureType:"poi.sports_complex",stylers:[{color:"#efebe2"}]},{featureType:"road",elementType:"labels.text",stylers:[{visibility:"on"}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{color:"#fbfbfb"}]},{featureType:"road.local",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"transit",stylers:[{visibility:"off"}]},{featureType:"water",stylers:[{color:"#a5d7e0"}]}],{name:"Simple"}),map.mapTypes.set("Simple",d);var d=new google.maps.StyledMapType([{featureType:"landscape.man_made",elementType:"geometry",stylers:[{color:"#f7f1df"}]},{featureType:"landscape.natural",elementType:"geometry",stylers:[{color:"#d0e3b4"}]},{featureType:"landscape.natural.terrain",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.business",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"poi.medical",elementType:"geometry",stylers:[{color:"#fbd3da"}]},{featureType:"poi.medical",elementType:"labels",stylers:[{visibility:"simplified"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#bde6ab"}]},{featureType:"poi.park",elementType:"labels",stylers:[{visibility:"simplified"}]},{featureType:"poi.sports_complex",elementType:"labels",stylers:[{visibility:"simplified"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"simplified"}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"labels",stylers:[{visibility:"simplified"}]},{featureType:"road.arterial",elementType:"labels.text",stylers:[{color:"#8f8f8f"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#ffe15f"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#efd151"}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{color:"black"}]},{featureType:"road.local",elementType:"labels",stylers:[{visibility:"simplified"}]},{featureType:"road.local",elementType:"labels.text",stylers:[{color:"#8f8f8f"}]},{featureType:"transit.station.airport",elementType:"geometry.fill",stylers:[{color:"#cfb2db"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#93d5f0"}]}],{name:"Styled Map"});map.mapTypes.set("Apple",d),map.setMapTypeId("Apple");for(var e=0;e<a.events.length;e++){var m,f=new google.maps.Marker({position:{lat:parseFloat(a.events[e].lat),lng:parseFloat(a.events[e].long)},map:map,icon:{path:google.maps.SymbolPath.CIRCLE,scale:8+a.events[e].rank/20,fillColor:"red",fillOpacity:.7,strokeColor:"white",strokeOpacity:.9,strokeWeight:1}}),g=a.events[e],h=g.start.split(" GMT")[0].replace("2017",""),i=h.split(" "),j=i[4].split(":"),k=j[0],l=j[1];parseInt(k)>=12?(k=(parseInt(k)-12).toString(),m=k+"."+l+" PM"):m=k+"."+l+" AM",address=g.address,null!=g.description&&""!=g.description||(g.description="No description available");var n="<div class='markerContainer'><div class='markerTitle' id='"+g.id+"'>"+g.name+"</div><p class='markerDesc'>"+g.description.substring(0,200)+"</p><div class='controls'><button class='ctrlBtn'>Save</button></div></div>";google.maps.event.addListener(f,"click",function(a,c){return function(){b.setContent(c),b.open(map,a)}}(f,n)),markers.push({id:g.id,marker:f})}google.maps.event.addListener(b,"domready",function(){var a=$(".gm-style-iw"),b=a.prev();b.children(":nth-child(2)").css({display:"none"}),b.children(":nth-child(4)").css({display:"none"}),a.parent().parent().css({left:"115px"}),a.parent().css({width:"350px"}),b.children(":nth-child(1)").attr("style",function(a,b){return b+"left: 76px !important;"}),b.children(":nth-child(3)").attr("style",function(a,b){return b+"left: 76px !important;"}),b.children(":nth-child(3)").find("div").children().css({"box-shadow":"rgba(72, 181, 233, 0.6) 0px 1px 6px","z-index":"1"});var c=a.next();c.css({opacity:"1",right:"5px !important",top:"18px !important","border-radius":"2px","box-shadow":"0 0 5px #3990B9"}),$(".iw-content").height()<140&&$(".iw-bottom-gradient").css({display:"none"}),c.mouseout(function(){$(this).css({opacity:"1",right:"5px !important",top:"18px !important","border-radius":"2px","box-shadow":"0 0 5px #3990B9"})})}),google.maps.event.addListener(map,"mousemove",function(){var a=$(".gm-style-iw"),b=a.prev();b.children(":nth-child(2)").css({display:"none"}),b.children(":nth-child(4)").css({display:"none"}),a.parent().parent().css({left:"115px"}),a.parent().css({width:"350px"}),b.children(":nth-child(1)").attr("style",function(a,b){return b+"left: 76px !important;"}),b.children(":nth-child(3)").attr("style",function(a,b){return b+"left: 76px !important;"}),b.children(":nth-child(3)").find("div").children().css({"box-shadow":"rgba(72, 181, 233, 0.6) 0px 1px 6px","z-index":"1"});var c=a.next();c.css({opacity:"1",right:"5px !important",top:"18px !important","border-radius":"2px","box-shadow":"0 0 5px #3990B9"}),$(".iw-content").height()<140&&$(".iw-bottom-gradient").css({display:"none"}),c.mouseout(function(){$(this).css({opacity:"1",right:"5px !important",top:"18px !important","border-radius":"2px","box-shadow":"0 0 5px #3990B9"})})}),google.maps.event.addListener(map,"click",function(a){b.close()}),sortBy("Size"),$("#sortBy").value="Size"}function pushToEventList(a){$("#events").empty();for(var b=0;b<a.events.length;b++){var i,c=a.events[b],d=c.start.split(" GMT")[0].replace("2017",""),e=d.split(" "),f=e[4].split(":"),g=f[0],h=f[1];parseInt(g)>=12?(g=(parseInt(g)-12).toString(),i=g+"."+h+" PM"):i=g+"."+h+" AM";for(var j="<div class='labels'><p class='eventRank'>"+c.rank+"</p>",k=0;k<c.labels.length;k++)j=j+"<div class='label'>"+c.labels[k]+"</div>";j+="</div>",$("#events").append("<div class='event' id='"+c.id+"'><p class='eventTitle'>"+c.name+"</p><p class='eventLocation'>"+c.address+"</p><p class='eventTime'>"+i+"</p>"+j+"</div>")}getAddresses()}function getAddresses(){for(var a=0;a<eventsData.events;a++)$.ajax({url:"http://maps.googleapis.com/maps/api/geocode/json?latlng="+parseFloat(eventsData.events[a].lat)+","+parseFloat(eventsData.events[a].long),method:"GET",success:function(b){setAddress(eventsData.events[a].id,b.results[0].formatted_address)}})}function setAddress(a,b){$("#"+a).find(".eventLocation").text(b)}function bindInfoWindow(a,b,c,d){google.maps.event.addListener(a,"click",function(){c.setContent(d),c.open(b,a)})}function setTodaysDate(){var a=new Date,b=a.getDate(),c=a.getMonth()+1,d=a.getFullYear();b<10&&(b="0"+b),c<10&&(c="0"+c),a=d+"-"+c+"-"+b,$("#sdate").attr("value",a),$("#edate").attr("value",a)}function sortBy(a){"Date"==a&&(eventsData.events.sort(function(a,b){return new Date(a.start)-new Date(b.start)}),$("#sortBy").value="Date"),"Size"==a&&(eventsData.events.sort(function(a,b){return b.rank-a.rank}),$("#sortBy").value="Size"),"Category"==a&&(eventsData.events.sort(function(a,b){return a.labels[0]<b.labels[0]?-1:a.labels[0]>b.labels[0]?1:0}),$("#sortBy").value="Category"),pushToEventList(eventsData)}function saveEventToDB(a){var b=JSON.stringify(a);$.ajax({url:"/saveevent",method:"POST",data:b,success:function(a){}})}var markers=[],eventsData;$(document).ready(function(){setTodaysDate(),getEvents($("#place").val());var a=$(window).height();a<950&&($(".mapCont").css("height",(a-155).toString()+"px"),$("#eventsList").css("height",(a-190).toString()+"px"),$("#events").css("height","calc(100% - 61px)"))}),$(document).ajaxStart(function(){$("#loading").show()}),$(document).ajaxStop(function(){$("#loading").hide()}),$("body").on("click",".event",function(){for(var b,a=$(this).attr("id"),c=0;c<markers.length;c++)if(markers[c].id==a){b=markers[c].marker;break}google.maps.event.trigger(b,"click")}),$("#searchHere").on("click",function(){var a=map.getCenter(),b=a.lat()+","+a.lng();getEvents(b)}),$(document).on("change","#sortBy",function(){var a=$("#sortBy").val();sortBy(a)}),$(document).on("click",".ctrlBtn",function(){for(var b,a=$(this).parent().prev().prev().attr("id"),c=eventsData.events,d=0;d<c.length;d++)if(c[d].id==a){b=c[d];break}saveEventToDB(b),$("#loading").hide()}),$("#search").on("click",function(){getEvents($("#place").val())});var map;